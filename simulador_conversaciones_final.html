<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Simulador de Conversaciones ‚Äî Modo Claro</title>
<style>
  :root{
    --bg:#ffffff;
    --surface:#ffffff;
    --muted:#334155;          /* gris azulado oscuro */
    --text:#0f172a;           /* azul muy oscuro para texto */
    --primary:#1e3a8a;        /* azul oscuro para bordes/acentos */
    --primary-2:#1d4ed8;      /* azul vivo para botones */
    --ok:#15803d;
    --warn:#b45309;
    --bad:#b91c1c;
    --chip:#f1f5f9;
    --bubble-user:#e0f2fe;
    --bubble-bot:#f8fafc;
    --shadow: 0 6px 20px rgba(2, 6, 23, .08);
    --radius:16px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background:var(--bg);
    color:var(--text);
    font:16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";
  }
  .app{max-width:1100px; margin:24px auto; padding:0 16px;}

  /* ====== Bloque del LOGO arriba ====== */
  .logo-slot{
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    gap:10px; padding:18px;
    background:var(--surface);
    border:2px solid var(--primary);
    border-radius:18px; box-shadow:var(--shadow);
    margin-bottom:14px;
    text-align:center;
  }
  .org-logo{
    max-height:90px; width:auto;
    display:block;
    border:2px solid var(--primary);
    border-radius:12px;
    padding:8px;
    background:#ffffff;
  }
  .logo-caption{
    font-weight:800; color:var(--primary); letter-spacing:.2px;
  }

  .header{
    display:flex; gap:16px; align-items:center; justify-content:space-between;
    background:var(--surface);
    border:2px solid var(--primary);
    padding:16px; border-radius:18px; box-shadow:var(--shadow);
  }
  .brand{display:flex; gap:12px; align-items:center;}
  h1{font-size:20px; margin:0; color:var(--primary)}
  .sub{color:var(--muted); font-size:13px}

  .controls{display:flex; gap:8px; flex-wrap:wrap; align-items:center;}
  select, button{
    background:#ffffff; color:var(--text);
    border:2px solid var(--primary);
    padding:10px 12px; border-radius:12px; font-weight:600;
  }
  button.primary{
    background:linear-gradient(120deg, var(--primary-2), #60a5fa);
    color:#ffffff; border:none; box-shadow:0 6px 14px rgba(29,78,216,.25);
  }
  button.ghost{background:transparent;border:2px dashed var(--primary)}
  button:disabled{opacity:.55; cursor:not-allowed}

  .layout{margin-top:16px; display:grid; grid-template-columns: 1.2fr .8fr; gap:16px;}
  @media (max-width: 880px){ .layout{grid-template-columns:1fr} }

  .card{
    background:var(--surface);
    border:2px solid var(--primary);
    border-radius:18px; box-shadow:var(--shadow);
  }

  /* Chat */
  .chat{display:flex; flex-direction:column; height:min(70vh, 680px)}
  .chat .scroll{padding:16px; overflow:auto; flex:1; scroll-behavior:smooth;}
  .msg{display:flex; gap:10px; margin:10px 0; max-width:85%; animation:fade-in .2s ease-out both;}
  .msg.bot{justify-content:flex-start}
  .msg.user{justify-content:flex-end; margin-left:auto}
  .bubble{padding:12px 14px; border-radius:14px; position:relative; border:2px solid var(--primary);}
  .bot .bubble{ background:var(--bubble-bot)}
  .user .bubble{ background:var(--bubble-user)}
  .meta{font-size:12px;color:var(--muted); margin-top:6px}
  .feedback{display:inline-flex; gap:6px; flex-wrap:wrap; margin-top:8px}
  .chip{
    font-size:12px; padding:6px 8px; border-radius:999px;
    background:var(--chip); border:2px solid var(--primary); color:var(--text);
  }
  .chip.ok{border-color:rgba(21,128,61,.35); color:var(--ok)}
  .chip.warn{border-color:rgba(180,83,9,.35); color:var(--warn)}
  .chip.bad{border-color:rgba(185,28,28,.35); color:var(--bad)}

  .suggest{display:flex; gap:8px; flex-wrap:wrap; margin:8px 0 0 0;}
  .sug{
    background:#ffffff; color:var(--text); border:2px solid var(--primary);
    padding:8px 10px; border-radius:999px; cursor:pointer; font-size:13px;
  }
  .sug:hover{background:#eff6ff; border-color:#1d4ed8}

  .composer{
    display:grid; grid-template-columns:1fr auto; gap:10px; padding:12px; border-top:2px solid var(--primary);
  }
  .composer input{
    background:#ffffff; color:var(--text); border:2px solid var(--primary);
    padding:12px 14px; border-radius:12px; outline:none;
  }

  /* Lateral (sin progreso/KPIs) */
  .side-section{padding:14px}
  .footer-actions{
    display:flex; gap:8px; flex-wrap:wrap; padding:12px; border-top:2px dashed var(--primary);
  }

  .tag{font-size:11px; background:#eff6ff; border:2px solid var(--primary); color:#0f172a;
    padding:4px 8px; border-radius:999px; display:inline-flex; gap:6px; align-items:center}
  .tag i{width:8px;height:8px;border-radius:50%}
  .tag.i-ok i{background:var(--ok)} .tag.i-warn i{background:var(--warn)} .tag.i-bad i{background:var(--bad)}

  @keyframes fade-in{from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:none}}
</style>
</head>
<body>
  <div class="app">

    <!-- ====== Espacio del LOGO ====== -->
    <div class="logo-slot">
      <!-- Cambia el src a la ruta de tu imagen. Si pones el archivo junto al HTML con nombre logo.png, se mostrar√° autom√°ticamente -->
      <img class="org-logo" src="logo-azul.png" alt="Logo Asperger para Asperger" />
      <div class="logo-caption">Circulo de Destrezas Sociales y para la vida</div>
    </div>

    <!-- Encabezado y controles -->
    <div class="header card">
      <div class="brand">
        <div>
          <h1>Simulador de Conversaciones</h1>
          <div class="sub">Pr√°ctica segura con retroalimentaci√≥n en tiempo real ‚Ä¢ Iniciar ‚Ä¢ Mantener ‚Ä¢ Cerrar</div>
        </div>
      </div>
      <div class="controls">
        <label class="sub" for="scenario">Escenario:</label>
        <select id="scenario" aria-label="Escoger escenario"></select>
        <button id="startBtn" class="primary">Iniciar</button>
        <button id="resetBtn" class="ghost">Reiniciar</button>
      </div>
    </div>

    <div class="layout">
      <!-- Chat -->
      <section class="card chat" aria-live="polite">
        <div id="scroll" class="scroll"></div>
        <div class="composer">
          <input id="input" type="text" placeholder="Escribe tu respuesta o toca una sugerencia‚Ä¶" aria-label="Tu mensaje">
          <button id="sendBtn" class="primary">Enviar</button>
        </div>
      </section>

      <!-- Panel lateral (sin progreso/KPIs) -->
      <aside class="card">
        <div class="side-section">
          <div class="sub" style="margin-bottom:8px;">Consejos r√°pidos</div>
          <div class="tag i-ok"><i></i> frases de 3‚Äì25 palabras</div>
          <div class="tag i-warn"><i></i> usa palabras del tema</div>
          <div class="tag i-bad"><i></i> evita desv√≠os largos</div>
        </div>
        <div class="footer-actions">
          <button id="hintBtn">Pista</button>
          <button id="repeatBtn">Repetir paso</button>
          <button id="endBtn">Finalizar escenario</button>
        </div>
      </aside>
    </div>
  </div>

<script>
/* ==============================
   UTILIDADES
============================== */
const $ = sel => document.querySelector(sel);
const el = (tag, props={}, children=[])=>{
  const node = document.createElement(tag);
  Object.assign(node, props);
  children.forEach(c => node.appendChild(c));
  return node;
};
const sleep = ms => new Promise(res=>setTimeout(res, ms));

/* ==============================
   ESCENARIOS (10 √ó 10 = 100 pasos)
============================== */
const SCENARIOS = [
  {
    id:'clase',
    title:'Clase: Presentaci√≥n y peque√±a charla',
    steps:[
      {bot:'¬°Hola! Soy Alex, tu compa√±ero de clase. ¬øC√≥mo te llamas?', opciones:['Soy Ana, gusto en conocerte.','Prefiero no decir mi nombre por ahora.','Puedes decirme ‚ÄúNico‚Äù.'], keywords:['nombre','llamo','apodo','conocerte'], tip:'Presentarte de forma sencilla funciona muy bien.'},
      {bot:'¬øC√≥mo va tu d√≠a hasta ahora?', opciones:['Bien, algo ocupado con tareas.','Cansado, dorm√≠ poco.','Tranquilo, gracias por preguntar.'], keywords:['bien','cansado','tranquilo','tareas','dorm√≠'], tip:'Comparte un estado breve y honesto.'},
      {bot:'¬øQu√© te parece la clase de matem√°ticas?', opciones:['Interesante pero dif√≠cil a veces.','Me cuesta; el profesor va r√°pido.','Me gusta resolver problemas.'], keywords:['interesante','dif√≠cil','r√°pido','profesor','problemas'], tip:'Puedes decir algo que te gusta y algo que mejorar√≠as.'},
      {bot:'¬øSueles estudiar en grupo o solo?', opciones:['Prefiero estudiar solo.','En grupo, me ayuda a entender.','Depende del tema.'], keywords:['solo','grupo','depende'], tip:'Ambas opciones son v√°lidas; explica por qu√©.'},
      {bot:'Tenemos un ejercicio para ma√±ana. ¬øYa lo empezaste?', opciones:['S√≠, hice la mitad.','No a√∫n, planeo empezar hoy.','Tengo dudas y pedir√© ayuda.'], keywords:['s√≠','mitad','no','empezar','dudas','ayuda'], tip:'Indica tu plan o avance.'},
      {bot:'¬øQu√© estrategia te funciona para problemas dif√≠ciles?', opciones:['Dividir el problema en partes.','Repasar ejemplos similares.','Pedir una pista al profe.'], keywords:['dividir','ejemplos','pista','profe'], tip:'Ofrece una t√°ctica concreta.'},
      {bot:'¬øQuieres formar equipo para el proyecto?', opciones:['S√≠, me gustar√≠a.','Tal vez, seg√∫n el horario.','Prefiero trabajar solo esta vez.'], keywords:['equipo','horario','solo'], tip:'Contesta claro y cort√©s.'},
      {bot:'¬øQu√© otros cursos te gustan?', opciones:['Historia y literatura.','F√≠sica, me encanta.','Arte y m√∫sica.'], keywords:['historia','literatura','f√≠sica','arte','m√∫sica'], tip:'Menciona 1‚Äì2 intereses.'},
      {bot:'Genial. ¬øTe va si practicamos 20 min despu√©s de clase?', opciones:['Perfecto, nos vemos a las 3.','Hoy no puedo, ¬øma√±ana?','S√≠, pero solo 10 min.'], keywords:['perfecto','hora','ma√±ana','puedo','min'], tip:'Negocia tiempo y hora.'},
      {bot:'¬°Gracias por hablar! Tengo que irme. ¬øDeseas cerrar la conversaci√≥n?', opciones:['Gracias, hablamos luego.','Fue un gusto, ¬°hasta luego!','Claro, que tengas buen d√≠a.'], keywords:['gracias','gusto','hasta','d√≠a'], tip:'Cierre breve y amable.', end:true}
    ]
  },
  {
    id:'trabajo',
    title:'Trabajo: Reuni√≥n breve con colega',
    steps:[
      {bot:'Hola, soy Sam de soporte. ¬øTienes un minuto?', opciones:['S√≠, dime.','Ahora no, ¬øpodemos en 15?','Depende del tema.'], keywords:['s√≠','ahora','15','tema'], tip:'Disponibilidad clara ayuda.'},
      {bot:'Tenemos un bug en el informe. ¬øLo viste?', opciones:['S√≠, lo not√© hoy.','No, ¬øqu√© ocurre?','Sospecho que es por la √∫ltima actualizaci√≥n.'], keywords:['bug','informe','actualizaci√≥n','not√©'], tip:'Nombra el problema.'},
      {bot:'¬øPuedes revisarlo antes de las 4?', opciones:['S√≠, lo reviso ahora.','Puedo a las 3:30.','Necesito hasta ma√±ana.'], keywords:['revisar','hora','ma√±ana'], tip:'Compromiso realista.'},
      {bot:'Si necesitas datos, te paso acceso.', opciones:['Por favor, comp√°rtelos.','Ya tengo acceso.','Me sirve un ejemplo de error.'], keywords:['acceso','compartir','ejemplo','error'], tip:'Pide lo que necesitas.'},
      {bot:'¬øC√≥mo te gustar√≠a que registremos el avance?', opciones:['En el tablero Kanban.','Con un comentario en Jira.','Un mensaje diario est√° bien.'], keywords:['kanban','jira','mensaje','diario'], tip:'Elige un canal.'},
      {bot:'Detect√© que falla con archivos grandes.', opciones:['Har√© una prueba con 200MB.','Entonces es l√≠mite de memoria.','Tal vez es el parser.'], keywords:['prueba','MB','memoria','parser'], tip:'Prop√≥n hip√≥tesis o pruebas.'},
      {bot:'¬øPrefieres que hagamos pairing?', opciones:['S√≠, 30 min.','No por ahora.','Podemos ma√±ana.'], keywords:['pairing','30','ma√±ana','no'], tip:'Coordina.'},
      {bot:'Te aviso si hay cambios urgentes.', opciones:['Perfecto, quedo atento.','Gracias, me mencionas.','Ok, monitoreo el canal.'], keywords:['perfecto','atento','gracias','monitoreo'], tip:'Confirma recepci√≥n.'},
      {bot:'¬øAlgo m√°s que deba saber?', opciones:['No, con eso basta.','Solo el deadline del cliente.','Revisa permisos de escritura.'], keywords:['deadline','cliente','permisos','basta'], tip:'Cierra pendientes.'},
      {bot:'Listo, gracias por tu tiempo.', opciones:['Gracias a ti, seguimos.','¬°√âxitos!','Hasta luego.'], keywords:['gracias','√©xitos','luego'], tip:'Cierre cordial.', end:true}
    ]
  },
  {
    id:'restaurante',
    title:'Restaurante: hacer un pedido',
    steps:[
      {bot:'¬°Bienvenido! ¬øMesa para cu√°ntas personas?', opciones:['Para una, por favor.','Para dos.','Somos cuatro.'], keywords:['una','dos','cuatro','mesa'], tip:'Responde n√∫mero claro.'},
      {bot:'¬øPrefieres interior o terraza?', opciones:['Terraza, si hay.','Interior est√° bien.','Donde est√© m√°s tranquilo.'], keywords:['terraza','interior','tranquilo'], tip:'Indica preferencia.'},
      {bot:'¬øTe ofrezco algo de beber?', opciones:['Agua con gas.','Jugo de naranja.','Solo agua natural.'], keywords:['agua','jugo','beber','naranja'], tip:'Pide 1 bebida.'},
      {bot:'Tenemos men√∫ del d√≠a y a la carta.', opciones:['¬øQu√© incluye el men√∫?','Ver√© la carta.','¬øOpciones sin gluten?'], keywords:['men√∫','carta','gluten'], tip:'Pregunta para decidir.'},
      {bot:'El men√∫ incluye sopa y pasta.', opciones:['Me quedo con el men√∫.','Prefiero la pasta sola.','¬øPuedo cambiar la sopa?'], keywords:['men√∫','pasta','sopa','cambiar'], tip:'Confirma o negocia.'},
      {bot:'¬øPunto de cocci√≥n?', opciones:['Al dente.','Suave.','Como lo recomienden.'], keywords:['al dente','suave','recomienden'], tip:'Da una especificaci√≥n.'},
      {bot:'¬øAlguna alergia o restricci√≥n?', opciones:['Sin l√°cteos, por favor.','Alergia al man√≠.','Ninguna.'], keywords:['sin','l√°cteos','man√≠','ninguna'], tip:'S√© claro y directo.'},
      {bot:'¬øDeseas postre?', opciones:['S√≠, flan.','No por ahora.','¬øQu√© postres tienen?'], keywords:['postre','flan','no','qu√©'], tip:'Acepta o pregunta.'},
      {bot:'¬øLa cuenta ser√° separada?', opciones:['Junta, gracias.','Separada.','Voy a pagar yo.'], keywords:['cuenta','separada','junta','pagar'], tip:'Indica tipo de pago.'},
      {bot:'Gracias por tu visita.', opciones:['Gracias, todo muy rico.','Nos vemos pronto.','Hasta luego.'], keywords:['gracias','rico','pronto','luego'], tip:'Cierre amable.', end:true}
    ]
  },
  {
    id:'hobby',
    title:'Club / Hobby: conversaci√≥n en actividad',
    steps:[
      {bot:'¬°Hola! ¬øEs tu primera vez en el club?', opciones:['S√≠, acabo de llegar.','No, ya vine antes.','Vengo a probar.'], keywords:['primera','llegar','antes','probar'], tip:'Da contexto simple.'},
      {bot:'¬øQu√© te interesa aprender hoy?', opciones:['Fundamentos b√°sicos.','T√©cnicas intermedias.','Conocer a la comunidad.'], keywords:['fundamentos','t√©cnicas','comunidad'], tip:'Elige un objetivo.'},
      {bot:'Trajimos material extra.', opciones:['Genial, ¬øpuedo usar uno?','Yo traje el m√≠o.','¬øHay para zurdos?'], keywords:['material','usar','traje','zurdos'], tip:'Pide recursos si necesitas.'},
      {bot:'Solemos dividir por niveles.', opciones:['Voy a nivel inicial.','Creo que soy intermedio.','Prefiero observar primero.'], keywords:['inicial','intermedio','observar'], tip:'Autoselecci√≥n honesta.'},
      {bot:'¬øQuieres un compa√±ero de pr√°ctica?', opciones:['S√≠, por favor.','Prefiero practicar solo.','Tal vez m√°s tarde.'], keywords:['compa√±ero','solo','m√°s tarde'], tip:'Expresa preferencia.'},
      {bot:'Haremos un descanso a mitad.', opciones:['Perfecto, aprovecho para hidratarme.','Bien, necesito estirar.','Avisen cuando sea.'], keywords:['descanso','hidratar','estirar','avisen'], tip:'Plan para el break.'},
      {bot:'¬øUsamos m√∫sica o silencio?', opciones:['M√∫sica suave.','Silencio me concentra.','Me es indiferente.'], keywords:['m√∫sica','silencio','indiferente'], tip:'Acuerdo grupal.'},
      {bot:'¬øTe gustar√≠a compartir un truco?', opciones:['S√≠, uno corto.','No por ahora.','Puedo mostrar al final.'], keywords:['compartir','truco','final','no'], tip:'Ofrece o declina respetuosamente.'},
      {bot:'¬øC√≥mo te sentiste hoy?', opciones:['Motivado, aprend√≠ algo nuevo.','Cansado pero satisfecho.','Me cost√≥, pedir√© consejos.'], keywords:['motivado','aprend√≠','cansado','satisfecho','consejos'], tip:'Habla de sensaciones.'},
      {bot:'Gracias por venir, nos despedimos.', opciones:['¬°Gracias! Hasta la pr√≥xima.','Me encant√≥, volver√©.','Buen d√≠a para todos.'], keywords:['gracias','pr√≥xima','volver√©','buen d√≠a'], tip:'Despedida positiva.', end:true}
    ]
  },
  {
    id:'transporte',
    title:'Transporte p√∫blico: pedir informaci√≥n',
    steps:[
      {bot:'Hola, ¬øbuscas alguna l√≠nea en particular?', opciones:['S√≠, la 32 hacia el centro.','¬øCu√°l va al museo?','No estoy seguro.'], keywords:['32','centro','museo','l√≠nea'], tip:'Di destino o n√∫mero.'},
      {bot:'La parada est√° a dos cuadras.', opciones:['¬øEn qu√© direcci√≥n?','Perfecto, gracias.','¬øHay se√±alizaci√≥n?'], keywords:['direcci√≥n','se√±al','gracias','parada'], tip:'Pide orientaci√≥n extra si lo necesitas.'},
      {bot:'Sale cada 10 minutos.', opciones:['Genial, ¬øla app muestra horarios?','Entonces esperar√© aqu√≠.','¬øHay retrasos hoy?'], keywords:['horarios','esperar','retrasos','app'], tip:'Confirma tiempo de espera.'},
      {bot:'Puedes pagar con tarjeta o efectivo.', opciones:['Uso tarjeta contactless.','Pago en efectivo.','¬øD√≥nde recargo?'], keywords:['tarjeta','efectivo','recargo'], tip:'Indica m√©todo de pago.'},
      {bot:'El viaje dura 15 a 20 minutos.', opciones:['Suficiente para llegar a mi cita.','Entonces salgo ya.','¬øHay asientos prioritarios?'], keywords:['minutos','cita','salgo','asientos'], tip:'Planea en funci√≥n del tiempo.'},
      {bot:'Recuerda validar al subir.', opciones:['Gracias por el recordatorio.','Lo har√©.','¬øSe valida al bajar tambi√©n?'], keywords:['validar','subir','bajar','gracias'], tip:'Aclara la regla.'},
      {bot:'Evita las horas pico si puedes.', opciones:['Buena idea, ir√© antes.','No puedo, tengo horario fijo.','¬øCu√°les son las horas pico?'], keywords:['pico','horario','antes','cu√°les'], tip:'Ajusta tu plan.'},
      {bot:'El chofer anuncia las paradas.', opciones:['Perfecto, estar√© atento.','¬øSe ilumina un cartel?','¬øPuedes avisarme del centro?'], keywords:['paradas','cartel','av√≠same','atento'], tip:'C√≥mo sabr√°s cu√°ndo bajar.'},
      {bot:'¬øNecesitas algo m√°s?', opciones:['No, muchas gracias.','Solo la ubicaci√≥n del museo.','¬øUn ba√±o cerca?'], keywords:['gracias','ubicaci√≥n','ba√±o','no'], tip:'√öltimas dudas.'},
      {bot:'Buen viaje.', opciones:['Gracias, que tengas buen d√≠a.','Hasta luego.','Muy amable.'], keywords:['gracias','d√≠a','luego','amable'], tip:'Despedida.', end:true}
    ]
  },
  {
    id:'medico',
    title:'Consulta m√©dica: recepci√≥n',
    steps:[
      {bot:'Buen d√≠a, recepci√≥n. ¬øNombre y motivo?', opciones:['Soy Laura, control anual.','Me llamo Diego, dolor de cabeza.','Prefiero dar datos en privado.'], keywords:['nombre','control','dolor','privado'], tip:'Entrega lo m√≠nimo necesario.'},
      {bot:'¬øTienes cita programada?', opciones:['S√≠, a las 10:30.','No, ¬øhay cupo hoy?','Reagend√© por la app.'], keywords:['cita','10:30','cupo','reagend√©','app'], tip:'Indica hora o estado.'},
      {bot:'Necesito tu documento.', opciones:['Aqu√≠ est√°.','Lo tengo digital.','Lo olvid√©, ¬øsirve otra identificaci√≥n?'], keywords:['documento','digital','olvid√©','identificaci√≥n'], tip:'Prop√≥n alternativa si falta.'},
      {bot:'¬øAlergias o medicaci√≥n actual?', opciones:['Alergia a penicilina.','Tomo ibuprofeno.','Ninguna.'], keywords:['alergia','penicilina','ibuprofeno','ninguna'], tip:'S√© espec√≠fico.'},
      {bot:'La espera es de 20 minutos.', opciones:['De acuerdo, me quedo aqu√≠.','¬øPuedo salir y volver?','¬øHay agua?'], keywords:['espera','20','salir','agua'], tip:'Gestiona la espera.'},
      {bot:'Completa este formulario.', opciones:['Lo har√© ahora.','¬øAlguna duda frecuente?','¬øPuedo hacerlo en el m√≥vil?'], keywords:['formulario','m√≥vil','ahora','duda'], tip:'Pregunta si algo no entiendes.'},
      {bot:'El doctor llamar√° por tu nombre.', opciones:['Perfecto.','¬øPueden avisar por mensaje?','¬øUsan pantalla?'], keywords:['nombre','mensaje','pantalla','perfecto'], tip:'Confirma el mecanismo.'},
      {bot:'¬øNecesitas comprobante para el trabajo?', opciones:['S√≠, por favor.','No es necesario.','Lo pido al salir.'], keywords:['comprobante','trabajo','salir','s√≠'], tip:'Antic√≠palo.'},
      {bot:'¬øAlguna molestia ahora?', opciones:['Solo un poco de n√°usea.','Dolor leve en la frente.','No, estoy bien.'], keywords:['n√°usea','dolor','frente','bien'], tip:'Describe intensidad simple.'},
      {bot:'Gracias, te avisamos.', opciones:['Gracias a ustedes.','Hasta pronto.','Quedo atento.'], keywords:['gracias','pronto','atento'], tip:'Cierre amable.', end:true}
    ]
  },
  {
    id:'fiesta',
    title:'Fiesta / evento social: conocer a alguien',
    steps:[
      {bot:'Hola, soy Val. ¬øC√≥mo te llamas?', opciones:['Soy Tom√°s.','Puedes decirme Tere.','Prefiero no decir.'], keywords:['soy','llamo','apodo','prefiero'], tip:'Presentaci√≥n breve.'},
      {bot:'¬øCon qui√©n viniste?', opciones:['Con un amigo.','Vine solo.','Con mi pareja.'], keywords:['amigo','solo','pareja'], tip:'Una palabra basta.'},
      {bot:'¬øTe gusta la m√∫sica de hoy?', opciones:['S√≠, est√° buena.','No es mi estilo.','Me gusta, pero un poco alta.'], keywords:['m√∫sica','estilo','alta','gusta'], tip:'Opina con respeto.'},
      {bot:'¬øQu√© bebidas prefieres?', opciones:['Agua/limonada.','Refresco.','Algo sin alcohol.'], keywords:['agua','limonada','refresco','sin alcohol'], tip:'Comunica l√≠mites.'},
      {bot:'¬øTienes hobbies?', opciones:['Videojuegos y lectura.','Bailar.','Cocinar.'], keywords:['videojuegos','lectura','bailar','cocinar'], tip:'Menciona 1‚Äì2.'},
      {bot:'¬øQu√© te trae a este evento?', opciones:['Cumple de un amigo.','Trabajo en la organizaci√≥n.','Vivo cerca.'], keywords:['cumple','organizaci√≥n','cerca'], tip:'Cuenta el motivo.'},
      {bot:'¬øQuieres unirte a nuestro grupo?', opciones:['S√≠, gracias.','Quiz√° luego.','Prefiero conversar aqu√≠.'], keywords:['unir','grupo','luego','prefiero'], tip:'Acepta o declina.'},
      {bot:'¬øTe molesta el ruido?', opciones:['Un poco, busquemos un lugar tranquilo.','Estoy bien.','S√≠, mejor afuera.'], keywords:['ruido','tranquilo','afuera','bien'], tip:'Prop√≥n ajuste.'},
      {bot:'¬øIntercambiamos contacto?', opciones:['Claro, Instagram.','Mejor por WhatsApp.','Prefiero no compartir.'], keywords:['instagram','whatsapp','no'], tip:'L√≠mite saludable.'},
      {bot:'¬°Hablamos luego!', opciones:['Gracias por la charla.','Hasta luego.','Fue un gusto.'], keywords:['gracias','luego','gusto'], tip:'Cierre positivo.', end:true}
    ]
  },
  {
    id:'soporte',
    title:'Soporte t√©cnico: problema con Wi-Fi',
    steps:[
      {bot:'Hola, ¬øqu√© problema tienes con el Wi-Fi?', opciones:['No conecta ning√∫n dispositivo.','Se desconecta cada rato.','La velocidad es muy baja.'], keywords:['conecta','desconecta','velocidad','wifi','wi-fi'], tip:'Describe el s√≠ntoma.'},
      {bot:'¬øDesde cu√°ndo sucede?', opciones:['Desde hoy.','Ayer por la noche.','Una semana.'], keywords:['hoy','ayer','semana','desde'], tip:'Indica tiempo.'},
      {bot:'¬øEncendiste y apagaste el router?', opciones:['S√≠, lo reinici√©.','No a√∫n.','Lo apagu√© 10 segundos.'], keywords:['reinici√©','apagu√©','router','10'], tip:'Acci√≥n b√°sica de prueba.'},
      {bot:'¬øCon cable funciona?', opciones:['S√≠, por cable va bien.','No tengo cable.','Tambi√©n falla por cable.'], keywords:['cable','funciona','falla'], tip:'A√≠sla el problema.'},
      {bot:'Veo interferencia en tu zona.', opciones:['Cambiar√© el canal.','¬øPuedes hacerlo por m√≠?','¬øOtra soluci√≥n?'], keywords:['canal','soluci√≥n','hacerlo'], tip:'Prop√≥n un paso.'},
      {bot:'¬øQu√© velocidad esperas?', opciones:['Al menos 50 Mbps.','Tengo plan de 100.','No lo s√©.'], keywords:['mbps','plan','100','50'], tip:'Da referencia.'},
      {bot:'¬øPodemos agendar visita t√©cnica?', opciones:['S√≠, ma√±ana por la tarde.','El s√°bado por la ma√±ana.','Prefiero remota.'], keywords:['ma√±ana','s√°bado','tarde','remota'], tip:'Disponibilidad clara.'},
      {bot:'Necesito un n√∫mero de contacto.', opciones:['Te paso mi celular.','Prefiero email.','Env√≠ame un enlace de agenda.'], keywords:['celular','email','agenda','n√∫mero'], tip:'Escoge canal c√≥modo.'},
      {bot:'Har√© seguimiento en 24h.', opciones:['Gracias, quedo atento.','Perfecto, me avisas.','OK.'], keywords:['gracias','atento','avisas','ok'], tip:'Confirma.'},
      {bot:'¬øAlgo m√°s?', opciones:['No, gracias.','Eso es todo.','Buen d√≠a.'], keywords:['no','gracias','todo','d√≠a'], tip:'Despedida.', end:true}
    ]
  },
  {
    id:'super',
    title:'Supermercado: buscar un producto',
    steps:[
      {bot:'Hola, ¬øbuscas algo en particular?', opciones:['Sal sin sodio.','Leche deslactosada.','Harina integral.'], keywords:['sal','sodio','leche','deslactosada','harina','integral'], tip:'Nombra el producto.'},
      {bot:'Est√° en el pasillo 4.', opciones:['¬øCerca de los condimentos?','Gracias.','¬øHay marca econ√≥mica?'], keywords:['pasillo','condimentos','marca','econ√≥mica'], tip:'Pide precisi√≥n o agradece.'},
      {bot:'¬øPrefieres marca X o Y?', opciones:['La m√°s econ√≥mica.','La que no tenga az√∫car.','Recomi√©ndame una.'], keywords:['econ√≥mica','az√∫car','recomienda'], tip:'Criterio simple.'},
      {bot:'Tenemos 2√ó1 en la segunda unidad.', opciones:['Entonces llevo dos.','Solo necesito una.','¬øVence pronto?'], keywords:['dos','una','vence','2x1'], tip:'Decide oferta.'},
      {bot:'¬øAlgo m√°s de tu lista?', opciones:['Tomates y cebollas.','Solo eso.','Papel de cocina.'], keywords:['tomates','cebollas','papel','lista'], tip:'A√±ade o termina.'},
      {bot:'¬øBolsas reutilizables?', opciones:['S√≠, una.','No, gracias.','Traje mis bolsas.'], keywords:['bolsas','reutilizables','traje'], tip:'Opciones ecol√≥gicas.'},
      {bot:'¬øPago en caja r√°pida?', opciones:['S√≠, pocas cosas.','Caja normal.','Autopago est√° bien.'], keywords:['caja','r√°pida','autopago','normal'], tip:'Elige caja.'},
      {bot:'¬øNecesitas factura?', opciones:['S√≠, a mi NIT.','No, gracias.','Solo ticket.'], keywords:['factura','NIT','ticket','no'], tip:'Documento de compra.'},
      {bot:'¬øDeseas redondear para donaci√≥n?', opciones:['S√≠, claro.','No por hoy.','¬øA qu√© causa?'], keywords:['donaci√≥n','s√≠','no','causa'], tip:'Responde breve.'},
      {bot:'Gracias por tu compra.', opciones:['Gracias a ustedes.','Hasta luego.','Buen d√≠a.'], keywords:['gracias','luego','d√≠a'], tip:'Cierre.', end:true}
    ]
  },
  {
    id:'entrevista',
    title:'Entrevista de pr√°cticas (light)',
    steps:[
      {bot:'Bienvenido, ¬øpodr√≠as presentarte?', opciones:['Soy estudiante de inform√°tica.','Me llamo Sara, me interesa el √°rea web.','Prefiero una presentaci√≥n breve.'], keywords:['estudiante','inform√°tica','web','presentaci√≥n'], tip:'1‚Äì2 frases es suficiente.'},
      {bot:'¬øQu√© proyecto te enorgullece?', opciones:['Una app de notas.','Un sitio accesible.','Un bot sencillo.'], keywords:['app','notas','accesible','bot'], tip:'Nombra 1 ejemplo.'},
      {bot:'¬øQu√© lenguaje manejas mejor?', opciones:['JavaScript.','Python.','Java.'], keywords:['javascript','python','java','lenguaje'], tip:'Elige uno principal.'},
      {bot:'¬øPrefieres frontend o backend?', opciones:['Frontend.','Backend.','Full-stack.'], keywords:['frontend','backend','full'], tip:'Preferencia clara.'},
      {bot:'¬øC√≥mo trabajas en equipo?', opciones:['Uso tableros y dailies.','Comunico avances y bloqueos.','Pido feedback frecuente.'], keywords:['tableros','dailies','bloqueos','feedback'], tip:'Menciona h√°bitos.'},
      {bot:'¬øC√≥mo aprendes algo nuevo?', opciones:['Documentaci√≥n oficial.','Cursos cortos.','Proyectos peque√±os.'], keywords:['documentaci√≥n','cursos','proyectos'], tip:'Proceso de aprendizaje.'},
      {bot:'¬øDisponibilidad horaria?', opciones:['Ma√±anas.','Tardes.','Part-time flexible.'], keywords:['ma√±anas','tardes','flexible'], tip:'S√© concreto.'},
      {bot:'¬øExpectativas de la pr√°ctica?', opciones:['Aprender buenas pr√°cticas.','Mejorar en equipo.','Contribuir a un producto real.'], keywords:['buenas pr√°cticas','equipo','producto'], tip:'Metas realistas.'},
      {bot:'¬øPreguntas para nosotros?', opciones:['S√≠, sobre el mentor.','Sobre el stack.','Sobre el proceso de feedback.'], keywords:['mentor','stack','feedback','preguntas'], tip:'Haz 1 pregunta.'},
      {bot:'Gracias por tu tiempo.', opciones:['Gracias a ustedes.','Quedo atento.','Hasta pronto.'], keywords:['gracias','atento','pronto'], tip:'Cierre.', end:true}
    ]
  },
  {
    id:'telefono',
    title:'Llamada breve / coordinaci√≥n',
    steps:[
      {bot:'Hola, ¬øpuedes hablar ahora?', opciones:['S√≠, 5 minutos.','En 10 minutos.','No puedo, agenda por mensaje.'], keywords:['s√≠','5','10','agenda','mensaje'], tip:'Disponibilidad concreta.'},
      {bot:'Necesito confirmar una direcci√≥n.', opciones:['Es Calle 10 #22.','Te la env√≠o por chat.','No la recuerdo.'], keywords:['direcci√≥n','calle','enviar','chat'], tip:'Entrega dato o plan.'},
      {bot:'¬øQu√© horario te conviene?', opciones:['Ma√±ana a las 9.','Hoy a las 17.','Cualquier hora.'], keywords:['ma√±ana','9','17','hora'], tip:'Propuesta espec√≠fica.'},
      {bot:'¬øPrefieres llamada o videollamada?', opciones:['Videollamada.','Llamada.','Me da igual.'], keywords:['video','llamada','igual'], tip:'Elige canal.'},
      {bot:'Durar√° 20 minutos.', opciones:['Perfecto.','¬øPodemos hacerlo en 15?','Est√° bien.'], keywords:['20','15','perfecto','bien'], tip:'Negocia duraci√≥n.'},
      {bot:'Enviar√© invitaci√≥n.', opciones:['Gracias.','Recibido.','¬øPuedes incluir agenda?'], keywords:['invitaci√≥n','agenda','gracias','recibido'], tip:'Confirma y pide agenda.'},
      {bot:'¬øAlg√∫n material previo?', opciones:['S√≠, te mando un PDF.','No es necesario.','Solo un resumen.'], keywords:['pdf','resumen','material','no'], tip:'Ahorra tiempo.'},
      {bot:'Si surge un imprevisto, avisa.', opciones:['De acuerdo.','Aviso por chat.','Reagendamos si pasa.'], keywords:['aviso','imprevisto','reagendar'], tip:'Plan B claro.'},
      {bot:'¬øAlgo m√°s que cerrar?', opciones:['Nada m√°s.','Solo confirmar asistentes.','Todo listo.'], keywords:['nada','asistentes','listo'], tip:'Checklist final.'},
      {bot:'¬°Gracias! Hablamos luego.', opciones:['Gracias.','Hasta luego.','Nos vemos.'], keywords:['gracias','luego','vemos'], tip:'Cierre.', end:true}
    ]
  }
];

// Verificaci√≥n (‚â•100 pasos)
const TOTAL_STEPS = SCENARIOS.reduce((acc,s)=>acc + s.steps.length, 0);

/* ==============================
   ESTADO
============================== */
let state = {
  scenarioIndex: 0,
  stepIndex: -1,
  history: [],
  started: false
};

/* ==============================
   RENDER
============================== */
function addMsg(role, text, feedback=[]) {
  const wrap = el('div', {className:`msg ${role}`});
  const bubble = el('div', {className:'bubble'});
  bubble.textContent = text;
  wrap.appendChild(bubble);

  if (feedback.length){
    const fb = el('div', {className:'feedback'});
    feedback.forEach(f=>{
      const chip = el('span', {className:`chip ${f.type}`});
      chip.textContent = f.text;
      fb.appendChild(chip);
    });
    wrap.appendChild(fb);
  }
  $('#scroll').appendChild(wrap);
  $('#scroll').scrollTop = $('#scroll').scrollHeight;
}

function renderBotStep(step){
  addMsg('bot', step.bot);
  renderSuggestions(step);
}

function renderSuggestions(step){
  const cont = el('div', {className:'suggest'});
  step.opciones.forEach(opt=>{
    const b = el('button', {className:'sug', type:'button'});
    b.textContent = opt;
    b.addEventListener('click', ()=> {
      $('#input').value = opt;
      sendUser();
    });
    cont.appendChild(b);
  });
  const tip = el('div', {className:'meta'});
  tip.textContent = 'Sugerencias ‚Ä¢ ' + (step.tip || '');
  cont.appendChild(tip);

  const last = Array.from($('#scroll').querySelectorAll('.msg.bot')).pop();
  last.appendChild(cont);
}

/* ==============================
   EVALUACI√ìN EN TIEMPO REAL
============================== */
const STOPWORDS = new Set('de la los las un una y o u en es a con por para que como muy m√°s menos pero si no del al lo le les me te se'.split(' '));

function tokenize(str){
  return str.toLowerCase()
    .replace(/[√°√†√§]/g,'a').replace(/[√©√®√´]/g,'e').replace(/[√≠√Ø√¨]/g,'i').replace(/[√≥√≤√∂]/g,'o').replace(/[√∫√π√º]/g,'u')
    .replace(/[^a-z0-9√± ]+/g,' ')
    .split(/\s+/).filter(w=>w && !STOPWORDS.has(w));
}

function uniqueKeywords(step){
  const kw = new Set(step.keywords.map(k=>k.toLowerCase()));
  step.opciones.forEach(o=>{
    tokenize(o).forEach(t=>{ if(t.length>2) kw.add(t) });
  });
  return Array.from(kw);
}

function evaluateMessage(msg, step){
  const words = tokenize(msg);
  const len = words.length;

  let lengthTag = null;
  if (len <= 2) lengthTag = {type:'warn', text:'muy corta'};
  else if (len >= 40) lengthTag = {type:'warn', text:'muy larga'};
  else lengthTag = {type:'ok', text:'longitud adecuada'};

  const kws = uniqueKeywords(step);
  const hits = words.filter(w => kws.includes(w)).length;
  const rel = Math.round( Math.min(100, (hits / Math.max(4, Math.min(10, kws.length))) * 100) );

  let contextTag = null;
  if (rel === 0) contextTag = {type:'bad', text:'fuera de contexto'};
  else if (rel <= 25) contextTag = {type:'warn', text:'poco espec√≠fico'};
  else contextTag = {type:'ok', text:'en tema'};

  return { rel, lengthTag, contextTag };
}

/* ==============================
   L√ìGICA DE FLUJO
============================== */
async function startScenario(idx){
  state.scenarioIndex = idx;
  state.stepIndex = 0;
  state.history = [];
  state.started = true;
  $('#scroll').innerHTML = '';
  const s = SCENARIOS[idx];
  addMsg('bot', `‚ú® Escenario seleccionado: ${s.title}. ¬°Comencemos!`);
  await sleep(300);
  renderBotStep(s.steps[state.stepIndex]);
}

function nextStep(){
  const s = SCENARIOS[state.scenarioIndex];
  if (state.stepIndex < s.steps.length - 1){
    state.stepIndex++;
    renderBotStep(s.steps[state.stepIndex]);
  } else {
    showSummary();
  }
}

function repeatStep(){
  const s = SCENARIOS[state.scenarioIndex];
  renderBotStep(s.steps[state.stepIndex]);
}

function showSummary(){
  const attempts = state.history.filter(h=>h.role==='user').length;
  const avgRel = Math.round(state.history.filter(h=>h.rel!==undefined).reduce((a,b)=>a+b.rel,0) / Math.max(1, attempts));
  const okCount = state.history.filter(h=>h.role==='user' && h.contextOk).length;

  const txt = `‚úÖ Escenario completado.
‚Ä¢ Intervenciones tuyas: ${attempts}
‚Ä¢ Relevancia media (estimada): ${isFinite(avgRel)?avgRel:0}%
‚Ä¢ Consejo: procura mantener frases de 3‚Äì25 palabras y usar palabras clave del contexto.`;

  addMsg('bot', txt);
}

/* ==============================
   RESPUESTA DEL USUARIO
============================== */
async function sendUser(){
  const input = $('#input');
  const text = (input.value || '').trim();
  if (!text) return;
  input.value = '';
  const s = SCENARIOS[state.scenarioIndex];
  const step = s.steps[state.stepIndex];

  const ev = evaluateMessage(text, step);
  const fb = [
    {type: ev.lengthTag.type, text: ev.lengthTag.text},
    {type: ev.contextTag.type, text: ev.contextTag.text},
  ];
  addMsg('user', text, fb);

  state.history.push({role:'user', text, rel: ev.rel, contextOk: ev.contextTag.type==='ok'});

  await sleep(250);
  if (ev.contextTag.type === 'bad') {
    addMsg('bot', `Creo que te fuiste un poco del tema. ${step.tip || 'Intenta usar palabras del contexto.'}`);
    renderSuggestions(step);
    return; // no avanzar
  }

  if (ev.lengthTag.type !== 'ok'){
    addMsg('bot', `Gracias. Intenta una frase ${text.split(' ').length<=2 ? 'un poco m√°s larga' : 'm√°s breve'} la pr√≥xima vez.`);
  } else if (ev.rel < 25){
    addMsg('bot', 'Vas bien. ¬øPodr√≠as ser un poco m√°s espec√≠fico?');
  } else {
    addMsg('bot', '¬°Perfecto! Continuemos‚Ä¶');
  }

  await sleep(250);
  if (step.end){
    addMsg('bot', 'Has practicado una despedida amable. Puedes finalizar o elegir otro escenario.');
  }
  nextStep();
}

/* ==============================
   UI INIT
============================== */
function initSelectors(){
  const sel = $('#scenario');
  SCENARIOS.forEach((s, i)=>{
    const opt = el('option', {value:i, textContent:`${i+1}. ${s.title}`});
    sel.appendChild(opt);
  });
  sel.value = 0;
}

function attachEvents(){
  $('#startBtn').addEventListener('click', ()=>{
    startScenario(parseInt($('#scenario').value,10));
  });
  $('#resetBtn').addEventListener('click', ()=>{
    if (!state.started) return;
    startScenario(state.scenarioIndex);
  });
  $('#sendBtn').addEventListener('click', sendUser);
  $('#input').addEventListener('keydown', (e)=>{
    if (e.key==='Enter'){ e.preventDefault(); sendUser(); }
  });
  $('#hintBtn').addEventListener('click', ()=>{
    const s = SCENARIOS[state.scenarioIndex];
    const step = s.steps[state.stepIndex];
    addMsg('bot', 'Pista: ' + (step.tip || 'Usa palabras clave del contexto.' ));
  });
  $('#repeatBtn').addEventListener('click', repeatStep);
  $('#endBtn').addEventListener('click', showSummary);
}

/* ==============================
   ARRANQUE
============================== */
initSelectors();
attachEvents();
addMsg('bot', 'üëã Bienvenido al simulador (modo claro). Elige un escenario y toca ‚ÄúIniciar‚Äù. Practica iniciar, mantener y cerrar conversaciones con retroalimentaci√≥n en tiempo real.');
if (TOTAL_STEPS < 100){
  addMsg('bot', `Nota: se detectaron ${TOTAL_STEPS} pasos. (M√≠nimo recomendado: 100)`);
}
</script>
</body>
</html>
